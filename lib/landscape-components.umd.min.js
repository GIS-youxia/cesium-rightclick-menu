(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t(require("vue")):"function"===typeof define&&define.amd?define([],t):"object"===typeof exports?exports["landscape-components"]=t(require("vue")):e["landscape-components"]=t(e["Vue"])})("undefined"!==typeof self?self:this,(function(e){return function(){var t={457:function(e,t,i){"use strict";i.r(t);var n=i(81),s=i.n(n),o=i(645),r=i.n(o),a=r()(s());a.push([e.id,".map__wrap[data-v-4e672d48]{position:relative;overflow:hidden;height:100%}.map__wrap .alertMenu[data-v-4e672d48]{position:absolute;display:flex;width:320px;height:250px;border-radius:4px;z-index:9999}.map__wrap .alertMenu .level__one[data-v-4e672d48]{border:1px solid rgba(53,123,181,.6);background:#081a26;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:space-between;cursor:pointer;color:#cce3ff;font-size:14px}.map__wrap .alertMenu .level__one .level__one__item[data-v-4e672d48]{padding:5px 0;width:100%;display:flex}.map__wrap .alertMenu .active[data-v-4e672d48]{background-color:rgba(53,123,181,.6)}.map__wrap .alertMenu .level__two[data-v-4e672d48]{border:1px solid rgba(53,123,181,.6);background:#081a26;margin-left:2px;width:40%;display:flex;align-self:baseline;flex-direction:column;align-items:center;cursor:pointer;color:#cce3ff;font-size:14px}.map__wrap .alertMenu .level__two .level__two__item[data-v-4e672d48]{padding:5px 0;width:100%;display:flex;align-items:center;justify-content:center}.map__wrap .height__as[data-v-4e672d48]{position:absolute;top:20px;right:20px;background:#081a26;border:1px solid rgba(53,123,181,.6);width:200px;padding:10px}.map__wrap .height__as .h__content[data-v-4e672d48]{display:flex;align-items:center;color:#fff}.map__wrap .fc_dialog[data-v-4e672d48]{position:absolute;top:20px;right:20px;background:#081a26;border:1px solid rgba(53,123,181,.6);width:200px;padding:10px;color:#fff}.map__wrap .el-slider[data-v-4e672d48]{width:140px}#slider[data-v-4e672d48]{position:absolute;left:50%;top:0;background-color:#d3d3d3;width:5px;height:100%;z-index:9999}#slider[data-v-4e672d48]:hover{cursor:ew-resize}",""]),t["default"]=a},645:function(e){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var i="",n="undefined"!==typeof t[5];return t[4]&&(i+="@supports (".concat(t[4],") {")),t[2]&&(i+="@media ".concat(t[2]," {")),n&&(i+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),i+=e(t),n&&(i+="}"),t[2]&&(i+="}"),t[4]&&(i+="}"),i})).join("")},t.i=function(e,i,n,s,o){"string"===typeof e&&(e=[[null,e,void 0]]);var r={};if(n)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(r[l]=!0)}for(var h=0;h<e.length;h++){var c=[].concat(e[h]);n&&r[c[0]]||("undefined"!==typeof o&&("undefined"===typeof c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=o),i&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=i):c[2]=i),s&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=s):c[4]="".concat(s)),t.push(c))}},t}},81:function(e){"use strict";e.exports=function(e){return e[1]}},28:function(e,t,i){var n=i(457);n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[e.id,n,""]]),n.locals&&(e.exports=n.locals);var s=i(402).Z;s("1afab7c3",n,!0,{sourceMap:!1,shadowMode:!1})},402:function(e,t,i){"use strict";function n(e,t){for(var i=[],n={},s=0;s<t.length;s++){var o=t[s],r=o[0],a=o[1],l=o[2],h=o[3],c={id:e+":"+s,css:a,media:l,sourceMap:h};n[r]?n[r].parts.push(c):i.push(n[r]={id:r,parts:[c]})}return i}i.d(t,{Z:function(){return m}});var s="undefined"!==typeof document;if("undefined"!==typeof DEBUG&&DEBUG&&!s)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var o={},r=s&&(document.head||document.getElementsByTagName("head")[0]),a=null,l=0,h=!1,c=function(){},d=null,u="data-vue-ssr-id",p="undefined"!==typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function m(e,t,i,s){h=i,d=s||{};var r=n(e,t);return v(r),function(t){for(var i=[],s=0;s<r.length;s++){var a=r[s],l=o[a.id];l.refs--,i.push(l)}t?(r=n(e,t),v(r)):r=[];for(s=0;s<i.length;s++){l=i[s];if(0===l.refs){for(var h=0;h<l.parts.length;h++)l.parts[h]();delete o[l.id]}}}}function v(e){for(var t=0;t<e.length;t++){var i=e[t],n=o[i.id];if(n){n.refs++;for(var s=0;s<n.parts.length;s++)n.parts[s](i.parts[s]);for(;s<i.parts.length;s++)n.parts.push(w(i.parts[s]));n.parts.length>i.parts.length&&(n.parts.length=i.parts.length)}else{var r=[];for(s=0;s<i.parts.length;s++)r.push(w(i.parts[s]));o[i.id]={id:i.id,refs:1,parts:r}}}}function g(){var e=document.createElement("style");return e.type="text/css",r.appendChild(e),e}function w(e){var t,i,n=document.querySelector("style["+u+'~="'+e.id+'"]');if(n){if(h)return c;n.parentNode.removeChild(n)}if(p){var s=l++;n=a||(a=g()),t=f.bind(null,n,s,!1),i=f.bind(null,n,s,!0)}else n=g(),t=C.bind(null,n),i=function(){n.parentNode.removeChild(n)};return t(e),function(n){if(n){if(n.css===e.css&&n.media===e.media&&n.sourceMap===e.sourceMap)return;t(e=n)}else i()}}var y=function(){var e=[];return function(t,i){return e[t]=i,e.filter(Boolean).join("\n")}}();function f(e,t,i,n){var s=i?"":n.css;if(e.styleSheet)e.styleSheet.cssText=y(t,s);else{var o=document.createTextNode(s),r=e.childNodes;r[t]&&e.removeChild(r[t]),r.length?e.insertBefore(o,r[t]):e.appendChild(o)}}function C(e,t){var i=t.css,n=t.media,s=t.sourceMap;if(n&&e.setAttribute("media",n),d.ssrId&&e.setAttribute(u,t.id),s&&(i+="\n/*# sourceURL="+s.sources[0]+" */",i+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(s))))+" */"),e.styleSheet)e.styleSheet.cssText=i;else{while(e.firstChild)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(i))}}},838:function(e,t,i){"use strict";e.exports=i.p+"img/kaiwa_bottom.12438e79.png"},186:function(e,t,i){"use strict";e.exports=i.p+"img/kaiwa_side.5687b966.png"},203:function(t){"use strict";t.exports=e}},i={};function n(e){var s=i[e];if(void 0!==s)return s.exports;var o=i[e]={id:e,exports:{}};return t[e](o,o.exports,n),o.exports}!function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})}}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){n.p=""}();var s={};return function(){"use strict";n.r(s),n.d(s,{default:function(){return W}});var e={};if(n.r(e),n.d(e,{Area:function(){return v},Distance:function(){return w},Height:function(){return g}}),"undefined"!==typeof window){var t=window.document.currentScript,i=t&&t.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);i&&(n.p=i[1])}var o=function(){var e=this,t=e._self._c;return t("div",{staticClass:"map__wrap"},[t("div",{staticStyle:{width:"100%",height:"100%"},attrs:{id:"map3d"}},[e.sliderShow?t("div",{attrs:{id:"slider"}}):e._e()]),t("div",{directives:[{name:"show",rawName:"v-show",value:e.alertMenuState,expression:"alertMenuState"}],ref:"alertMenu",staticClass:"alertMenu",style:e.alertMenuStyle},[t("div",{staticClass:"level__one"},e._l(e.menuList,(function(i,n){return t("div",{key:n,ref:`menuItem${n}`,refInFor:!0,class:[e.activeIndex===n?"level__one__item active":"level__one__item"],on:{mouseover:function(t){return e.handleHover(n)},click:function(t){return e.executionMethod(i.handler,void 0)}}},[t("div",{staticStyle:{"padding-left":"10px"}},[t("i",{class:["icon iconfont "+i.icon]})]),e._v("  "+e._s(i.label)+"  "),i.children?t("div",[t("i",{staticClass:"icon iconfont icon-you",staticStyle:{"font-size":"12px"}})]):e._e()])})),0),e.activeMenuList&&e.activeMenuList.length?t("div",{staticClass:"level__two",style:e.menu_level2Style},e._l(e.activeMenuList,(function(i,n){return t("div",{key:n,class:[e.activeSubIndex===n?"level__two__item active":"level__two__item"],on:{click:function(t){return e.executionMethod(i.handler,n)},mouseover:function(t){return e.handleSubHover(n)}}},[t("div",[t("i",{class:["icon iconfont "+i.icon]})]),e._v("   "),t("span",[e._v(e._s(i.isSwitch?i.active?"关闭":"开启":""))]),e._v(e._s(i.label)+" ")])})),0):e._e()]),t("div",{directives:[{name:"show",rawName:"v-show",value:e.limitHeightShow,expression:"limitHeightShow"}],staticClass:"height__as"},[t("div",{staticClass:"h__content"},[t("div",{staticStyle:{"padding-right":"10px"}},[e._v(" 高度: ")]),t("div",[t("el-slider",{attrs:{"show-tooltip":!0,min:1,step:.5,max:1e3},on:{input:e.valueChange},model:{value:e.height,callback:function(t){e.height=t},expression:"height"}})],1)])]),e.properties?t("FcDialog",{staticClass:"fc_dialog",attrs:{properties:e.properties}}):e._e(),e.delDialogShow?t("div",{staticClass:"draw_dialog"},[t("div",{staticClass:"close_icon",on:{click:function(t){e.delDialogShow=!1}}}),t("div",{staticClass:"outer_box"},[t("div",{staticClass:"inner_box"},[t("div",{staticClass:"content"},[e._v(" 确定删除？ ")]),t("div",{staticStyle:{display:"flex","justify-content":"space-around"}},[t("div",{staticClass:"confirm_btn",on:{click:e.onCancel}},[t("span",[e._v("取消")])]),t("div",{staticClass:"confirm_btn",on:{click:e.onDelete}},[t("span",[e._v("确定")])])])])])]):e._e()],1)},r=[];function a(e){let t=e.split(","),i=t[0].match(/:(.*?);/)[1],n=atob(t[1]),s=n.length,o=new Uint8Array(s);while(s--)o[s]=n.charCodeAt(s);return new Blob([o],{type:i})}function l(e,t,i,n){let s=document.documentElement.clientWidth,o=document.documentElement.clientHeight,r={};return r=e<s-i&&t<o-n?{left:e+6+"px",top:t+6+"px"}:{left:e-2-i+"px",top:t-6-n+"px"},r}n(203);function h(e,t){const i=t.scene.globe.pick(window.viewer.camera.getPickRay(e),t.scene),n=t.scene.globe.ellipsoid,s=n.cartesianToCartographic(i),o=Cesium.Math.toDegrees(s.latitude),r=Cesium.Math.toDegrees(s.longitude);return{lat:o,lng:r}}function c(e,t){const i=t.scene.globe.ellipsoid,n=i.cartesianToCartographic(e),s=Cesium.Math.toDegrees(n.latitude),o=Cesium.Math.toDegrees(n.longitude);return{lat:s,lng:o}}function d(e){let t=e.scene.canvas,i=t.toDataURL("image/png").replace("image/png","image/octet-stream"),n=document.createElement("a"),s=a(i),o=URL.createObjectURL(s);n.download="scene.png",n.href=o,n.click()}function u(e){return{text:e,style:Cesium.LabelStyle.FILL,fillColor:Cesium.Color.fromCssColorString("#090909"),distanceDisplayCondition:new Cesium.DistanceDisplayCondition(0,5e3),font:"22pt",showBackground:!1,scale:.65,horizontalOrigin:Cesium.HorizontalOrigin.LEFT_CLICK,verticalOrigin:Cesium.VerticalOrigin.TOP,disableDepthTestDistance:1e4}}function p(e,t="",i){if("Polygon"===t){const t=e.polygon.hierarchy.getValue(Cesium.JulianDate.now()).positions;let n=Cesium.BoundingSphere.fromPoints(t).center;n=Cesium.Ellipsoid.WGS84.scaleToGeodeticSurface(n),window.viewer.entities.add({id:"Polygon_Label",position:n,label:{text:i,font:"500 18px monospace",fillColor:Cesium.Color.AQUA,heightReference:Cesium.HeightReference.CLAMP_TO_GROUND,disableDepthTestDistance:Number.POSITIVE_INFINITY}})}else e.label={text:i,font:"600 18px monospace",color:Cesium.Color.AQUA,fillColor:Cesium.Color.AQUA,heightReference:Cesium.HeightReference.CLAMP_TO_GROUND,disableDepthTestDistance:Number.POSITIVE_INFINITY,pixelOffset:new Cesium.Cartesian2(0,-15)}}class m{constructor(e){this.viewer=e,this.viewer.cesiumWidget.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK),this.initEvents()}activate(e){this.deactivate(),this.clear(),this.drawType=e,this.positions=[],this.tempPositions=[],this.registerEvents(),this.viewer.enableCursorStyle=!1,this.viewer._element.style.cursor="crosshair"}deactivate(){this.unRegisterEvents(),this.drawType=void 0,this.drawEntity=void 0,this.hideTooltip(),this.viewer._element.style.cursor="default",this.viewer.enableCursorStyle=!0}clear(){this.drawEntity&&(this.viewer.entities.remove(this.drawEntity),this.drawEntity=void 0)}initEvents(){this.handler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas),this.DrawStartEvent=new Cesium.Event,this.DrawEndEvent=new Cesium.Event,this.CancelEvent=new Cesium.Event}registerEvents(){this.viewer._element.style.cursor="crosshair";const e=document.createElement("div");e.style.cssText="\n          overflow: auto;\n          position:absolute;\n          background: rgba(0,0,0, .7);\n          color:white;\n          box-shadow: rgba(168, 168, 168, 0.295) 1px 2px 10px;\n          border-radius:5px;\n          padding: 5px 10px;\n          display:inline-block;\n          font-size:14px;\n          z-index:2\n        ",e.setAttribute("id","vc-tooltip"),document.body.appendChild(e),document.getElementById("vc-tooltip").innerHTML="点击左键开始，点击右键完成",this.leftClickEvent(),this.rightClickEvent(),this.mouseMoveEvent()}leftClickEvent(){this.handler.setInputAction((e=>{let t=this.viewer.scene.pickPosition(e.position);t||(t=this.viewer.scene.camera.pickEllipsoid(e.position,this.viewer.scene.globe.ellipsoid)),t&&(this.positions.push(t),this.tempPositions.push(t),1===this.positions.length&&this.handleFirstPosition())}),Cesium.ScreenSpaceEventType.LEFT_CLICK)}handleFirstPosition(){switch(this.drawType){case"Point":this.generatePoint(),this.drawEnd();break;case"Polyline":this.generatePolyline();break;case"Polygon":this.generatePolygon();break;case"Circle":this.generateCircle();break;case"Rectangle":this.generateRect();break}}generatePoint(){this.drawEntity=this.viewer.entities.add({position:this.positions[0],id:"markerPoint"+Math.random(),billboard:{image:"static/img/locate.png",verticalOrigin:Cesium.VerticalOrigin.BOTTOM}})}generatePolyline(){this.drawEntity=this.viewer.entities.add({id:"markerLine"+Math.random(),position:this.positions[0],polyline:{positions:new Cesium.CallbackProperty((e=>this.tempPositions),!1),width:3,material:new Cesium.PolylineOutlineMaterialProperty({color:Cesium.Color.YELLOW}),depthFailMaterial:new Cesium.PolylineOutlineMaterialProperty({color:Cesium.Color.YELLOW})}})}generatePolygon(){this.drawEntity=this.viewer.entities.add({polygon:{hierarchy:new Cesium.CallbackProperty((e=>new Cesium.PolygonHierarchy(this.tempPositions)),!1),material:Cesium.Color.RED.withAlpha(.4)},polyline:{positions:new Cesium.CallbackProperty((e=>this.tempPositions.concat(this.tempPositions[0])),!1),width:1,material:new Cesium.PolylineDashMaterialProperty({color:Cesium.Color.YELLOW}),depthFailMaterial:new Cesium.PolylineDashMaterialProperty({color:Cesium.Color.YELLOW})}})}generateCircle(){this.drawEntity=this.viewer.entities.add({position:this.positions[0],name:"circle",ellipse:{semiMinorAxis:new Cesium.CallbackProperty((()=>{const e=Math.sqrt(Math.pow(this.tempPositions[0].x-this.tempPositions[this.tempPositions.length-1].x,2)+Math.pow(this.tempPositions[0].y-this.tempPositions[this.tempPositions.length-1].y,2));return e||e+1}),!1),semiMajorAxis:new Cesium.CallbackProperty((()=>{let e=Math.sqrt(Math.pow(this.tempPositions[0].x-this.tempPositions[this.tempPositions.length-1].x,2)+Math.pow(this.tempPositions[0].y-this.tempPositions[this.tempPositions.length-1].y,2));return e||e+1}),!1),material:Cesium.Color.RED.withAlpha(.5),outline:!0}})}generateRect(){this.drawEntity=this.viewer.entities.add({name:"rectangle",position:this.positions[0],rectangle:{coordinates:new Cesium.CallbackProperty((()=>Cesium.Rectangle.fromCartesianArray([this.positions[0],this.tempPositions[this.tempPositions.length-1]])),!1),material:Cesium.Color.RED.withAlpha(.5)}})}mouseMoveEvent(){this.handler.setInputAction((e=>{this.viewer._element.style.cursor="crosshair";let t=this.viewer.scene.pickPosition(e.endPosition);t||(t=this.viewer.scene.camera.pickEllipsoid(e.startPosition,this.viewer.scene.globe.ellipsoid)),t&&this.drawEntity&&(this.tempPositions=this.positions.concat([t]),document.onmousemove=function(e){const t=document.getElementById("vc-tooltip");t&&(t.style.top=e.clientY+15+"px",t.style.left=e.clientX+15+"px")})}),Cesium.ScreenSpaceEventType.MOUSE_MOVE)}rightClickEvent(){this.handler.setInputAction((e=>{if(!this.drawEntity)return this.deactivate(),void this.CancelEvent.raiseEvent();switch(this.drawType){case"Polyline":this.drawEntity.polyline.positions=this.positions,this.minPositionCount=2;break;case"Polygon":this.drawEntity.polygon.hierarchy=this.positions,this.drawEntity.polyline.positions=this.positions.concat(this.positions[0]),this.minPositionCount=3;break}if(this.positions.length<this.minPositionCount)return this.clear(),this.CancelEvent.raiseEvent(),void this.deactivate();this.drawEnd()}),Cesium.ScreenSpaceEventType.RIGHT_CLICK)}unRegisterEvents(){this.handler.removeInputAction(Cesium.ScreenSpaceEventType.RIGHT_CLICK),this.handler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE),this.handler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)}drawEnd(){this.drawEntity.remove=()=>{this.viewer.entities.remove(this.drawEntity)},this.hideTooltip(),this.DrawEndEvent.raiseEvent(this.drawEntity,this.positions,this.drawType),this.deactivate()}hideTooltip(){const e=document.getElementById("vc-tooltip");e&&document.body.removeChild(e)}}class v{constructor(e){this.viewer=e,this.initEvents(),this.positions=[],this.tempPositions=[],this.vertexEntities=[],this.labelEntity=void 0,this.measureArea=0}initEvents(){this.handler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas),this.MeasureStartEvent=new Cesium.Event,this.MeasureEndEvent=new Cesium.Event}createPolygonEntity(){var e=this;this.polygonEntity=this.viewer.entities.add({id:"customize",polygon:{hierarchy:new Cesium.CallbackProperty((function(t){return new Cesium.PolygonHierarchy(e.tempPositions)}),!1),material:Cesium.Color.RED.withAlpha(.4),perPositionHeight:!1},polyline:{positions:new Cesium.CallbackProperty((function(t){return e.tempPositions.concat(e.tempPositions[0])}),!1),width:1,material:new Cesium.PolylineDashMaterialProperty({color:Cesium.Color.YELLOW}),depthFailMaterial:new Cesium.PolylineDashMaterialProperty({color:Cesium.Color.YELLOW})}})}createVertex(){var e=this.viewer.entities.add({position:this.positions[this.positions.length-1],type:"MeasureAreaVertex",point:{color:Cesium.Color.FUCHSIA,pixelSize:8,disableDepthTestDistance:500}});this.vertexEntities.push(e)}createResultLabel(){var e=this;this.mesureResultEntity=this.viewer.entities.add({position:new Cesium.CallbackProperty((function(t){return e.getCenterPosition()}),!1),type:"MeasureAreaResult",label:{text:new Cesium.CallbackProperty((function(t){return"面积"+e.getArea(e.tempPositions)+"平方米"}),!1),scale:.5,font:"normal 28px MicroSoft YaHei",distanceDisplayCondition:new Cesium.DistanceDisplayCondition(0,5e3),scaleByDistance:new Cesium.NearFarScalar(1e3,1,3e3,.4),verticalOrigin:Cesium.VerticalOrigin.BOTTOM,style:Cesium.LabelStyle.FILL_AND_OUTLINE,pixelOffset:new Cesium.Cartesian2(0,-30),outlineWidth:9,outlineColor:Cesium.Color.YELLOW}})}getCenterPosition(){var e=this;if(this.tempPositions.length<3)return this.tempPositions[0];let t=e.cartesian3ToPoint3D(this.tempPositions[this.tempPositions&&this.tempPositions.length-1]);return Cesium.Cartesian3.fromDegrees(t.x,t.y,this.height+20)}registerEvents(){const e=document.createElement("div");e.style.cssText="\n          overflow: auto;\n          position:absolute;\n          background: rgba(0,0,0, .7);\n          color:white;\n          box-shadow: rgba(168, 168, 168, 0.295) 1px 2px 10px;\n          border-radius:5px;\n          padding: 5px 10px;\n          display:inline-block;\n          font-size:14px;\n          z-index:2\n        ",e.setAttribute("id","vc-tooltip"),document.body.appendChild(e),document.getElementById("vc-tooltip").innerHTML="点击左键开始绘制，右键结束",this.leftClickEvent(),this.rightClickEvent(),this.mouseMoveEvent()}leftClickEvent(){var e=this;this.handler.setInputAction((function(t){var i,n=e.viewer.scene.pickPosition(t.position);n||(i=e.viewer.scene.globe.ellipsoid,n=e.viewer.scene.camera.pickEllipsoid(t.position,i)),n&&(e.positions.push(n),e.height=e.unifiedHeight(e.positions,e.height),1==e.positions.length&&e.createPolygonEntity(),e.createVertex())}),Cesium.ScreenSpaceEventType.LEFT_CLICK)}rightClickEvent(){var e=this;this.handler.setInputAction((function(t){!e.isMeasure||e.positions.length<3?(e.deactivate(),e.clear()):(e.tempPositions=[].concat(e.positions),e.polygonEntity.polyline={positions:e.positions.concat(e.positions[0]),width:2,material:Cesium.Color.YELLOW,depthFailMaterial:new Cesium.PolylineDashMaterialProperty({color:Cesium.Color.YELLOW})},e.polygonEntity.polygon.hierarchy=new Cesium.PolygonHierarchy(e.tempPositions),e.mesureResultEntity.position=e.getCenterPosition(),e.mesureResultEntity.label.text="总面积"+e.getArea(e.positions)+"平方米",e.measureEnd())}),Cesium.ScreenSpaceEventType.RIGHT_CLICK)}mouseMoveEvent(){var e=this;this.handler.setInputAction((function(t){var i;e.isMeasure&&(e.viewer._element.style.cursor="crosshair",(i=(i=e.viewer.scene.pickPosition(t.endPosition))||e.viewer.scene.camera.pickEllipsoid(t.startPosition,e.viewer.scene.globe.ellipsoid))&&e.handleMoveEvent(i)),document.onmousemove=function(e){const t=document.getElementById("vc-tooltip");t&&(t.style.top=e.clientY+15+"px",t.style.left=e.clientX+15+"px")}}),Cesium.ScreenSpaceEventType.MOUSE_MOVE)}handleMoveEvent(e){this.positions.length<1||(this.height=this.unifiedHeight(this.positions,this.height),this.tempPositions=this.positions.concat(e),3<=this.tempPositions.length&&!this.mesureResultEntity&&this.createResultLabel())}unifiedHeight(e,t){t=t||this.getPositionHeight(e[0]);for(var i=0;i<e.length;i++){var n=e[i],s=this.cartesian3ToPoint3D(n);e[i]=Cesium.Cartesian3.fromDegrees(s.x,s.y,t)}return t}getPositionHeight(e){return Cesium.Cartographic.fromCartesian(e).height}cartesian3ToPoint3D(e){return e=Cesium.Cartographic.fromCartesian(e),{x:Cesium.Math.toDegrees(e.longitude),y:Cesium.Math.toDegrees(e.latitude),z:e.height}}rotatePlane(e){return e=Cesium.Cartographic.fromCartesian(e),[Cesium.Math.toDegrees(e.longitude),Cesium.Math.toDegrees(e.latitude)]}getArea(e){if(e.length<3)return 0;var t=[],i=this;return e.forEach((function(e){t.push(i.rotatePlane(e))})),t.push(t[0]),e=turf.polygon([t]),turf.area(e).toFixed(2)}activate(){this.deactivate(),this.registerEvents(),this.viewer.enableCursorStyle=!1,this.viewer._element.style.cursor="crosshair",this.isMeasure=!0,this.measureArea=0}measureEnd(){this.deactivate(),this.MeasureEndEvent.raiseEvent(this.measureArea)}unRegisterEvents(){this.handler.removeInputAction(Cesium.ScreenSpaceEventType.RIGHT_CLICK),this.handler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE)}deactivate(){this.isMeasure&&(this.unRegisterEvents(),this.hideTooltip(),this.viewer._element.style.cursor="default",this.viewer.enableCursorStyle=!0,this.isMeasure=!1,this.tempPositions=[],this.positions=[],this.height=void 0)}clear(){var e=this;this.viewer.entities.remove(this.polygonEntity),this.polygonEntity=void 0,this.vertexEntities.forEach((function(t){e.viewer.entities.remove(t)})),this.vertexEntities=[],this.viewer.entities.remove(this.mesureResultEntity),this.mesureResultEntity=void 0,this.height=void 0}hideTooltip(){const e=document.getElementById("vc-tooltip");e&&document.body.removeChild(e)}}class g{constructor(e){this.viewer=e,this.initEvents(),this.positions=[],this.vertexEntities=[],this.labelEntity=void 0,this.measureHeight=0}initEvents(){this.handler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas),this.MeasureStartEvent=new Cesium.Event,this.MeasureEndEvent=new Cesium.Event}activate(){this.deactivate(),this.registerEvents(),this.viewer.enableCursorStyle=!1,this.viewer._element.style.cursor="default",this.isMeasure=!0,this.circleRadius=.1,this.measureHeight=0,this.positions=[]}deactivate(){this.isMeasure&&(this.unRegisterEvents(),this.viewer._element.style.cursor="pointer",this.viewer.enableCursorStyle=!0,this.isMeasure=!1)}clear(){this.viewer.entities.remove(this.lineEntity),this.lineEntity=void 0,this.viewer.entities.remove(this.labelEntity),this.labelEntity=void 0,this.removeCircleEntity(),this.vertexEntities.forEach((e=>{this.viewer.entities.remove(e)})),this.vertexEntities=[]}createLineEntity(){this.lineEntity=this.viewer.entities.add({polyline:{positions:new Cesium.CallbackProperty((e=>this.positions),!1),width:2,material:Cesium.Color.YELLOW,depthFailMaterial:new Cesium.PolylineDashMaterialProperty({color:Cesium.Color.RED})}})}createLabel(){this.labelEntity=this.viewer.entities.add({position:new Cesium.CallbackProperty((e=>this.positions[this.positions.length-1]),!1),label:{text:"",scale:.5,font:"normal 40px MicroSoft YaHei",distanceDisplayCondition:new Cesium.DistanceDisplayCondition(0,5e3),scaleByDistance:new Cesium.NearFarScalar(500,1,1500,.4),verticalOrigin:Cesium.VerticalOrigin.BOTTOM,style:Cesium.LabelStyle.FILL_AND_OUTLINE,pixelOffset:new Cesium.Cartesian2(0,-30),outlineWidth:9,outlineColor:Cesium.Color.WHITE}})}createVertex(e){let t=this.viewer.entities.add({position:new Cesium.CallbackProperty((t=>this.positions[e]),!1),type:"MeasureHeightVertex",point:{color:Cesium.Color.FUCHSIA,pixelSize:6}});this.vertexEntities.push(t)}createCircleEntitiy(){this.circleEntity=this.viewer.entities.add({position:new Cesium.CallbackProperty((e=>this.positions[this.positions.length-1]),!1),ellipse:{height:new Cesium.CallbackProperty((e=>positionHeight(this.positions[this.positions.length-1])),!1),semiMinorAxis:new Cesium.CallbackProperty((e=>this.circleRadius),!1),semiMajorAxis:new Cesium.CallbackProperty((e=>this.circleRadius),!1),material:Cesium.Color.YELLOW.withAlpha(.5)}})}removeCircleEntity(){this.viewer.entities.remove(this.circleEntity),this.circleEntity=void 0}registerEvents(){this.leftClickEvent(),this.rightClickEvent(),this.mouseMoveEvent()}leftClickEvent(){this.handler.setInputAction((e=>{this.viewer._element.style.cursor="default";let t=this.viewer.scene.pickPosition(e.position);if(!t){const i=this.viewer.scene.globe.ellipsoid;t=this.viewer.scene.camera.pickEllipsoid(e.position,i)}t&&(0==this.positions.length?(this.positions.push(t),this.createVertex(0),this.createLineEntity(),this.createCircleEntitiy(),this.createLabel()):this.measureEnd())}),Cesium.ScreenSpaceEventType.LEFT_CLICK)}mouseMoveEvent(){this.handler.setInputAction((e=>{if(!this.isMeasure)return;this.viewer._element.style.cursor="default";let t=this.viewer.scene.pickPosition(e.endPosition);t||(t=this.viewer.scene.camera.pickEllipsoid(e.startPosition,this.viewer.scene.globe.ellipsoid)),t&&this.handleMoveEvent(t)}),Cesium.ScreenSpaceEventType.MOUSE_MOVE)}handleMoveEvent(e){if(this.positions.length<1)return;let t=cartesian3Point3(this.positions[0]),i=cartesian3Point3(e);const n=i[2]-t[2];t[2]=i[2];const s=Cesium.Cartesian3.fromDegrees(t[0],t[1],i[2]);this.positions.length<2?(this.positions.push(s),this.createVertex(1)):(this.positions[1]=s,this.measureHeight=n.toFixed(3),this.labelEntity.label.text="高度："+this.measureHeight+" 米"),this.circleRadius=getDistanceH(this.positions[0],e)}rightClickEvent(){this.handler.setInputAction((e=>{this.isMeasure&&(this.deactivate(),this.clear())}),Cesium.ScreenSpaceEventType.RIGHT_CLICK)}measureEnd(){this.deactivate(),this.MeasureEndEvent.raiseEvent(this.measureHeight)}unRegisterEvents(){this.handler.removeInputAction(Cesium.ScreenSpaceEventType.RIGHT_CLICK),this.handler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE)}}class w{constructor(e){this.viewer=e,this.initEvents(),this.positions=[],this.tempPositions=[],this.vertexEntities=[],this.labelEntity=void 0,this.measureDistance=0}initEvents(){this.handler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas),this.MeasureStartEvent=new Cesium.Event,this.MeasureEndEvent=new Cesium.Event}activate(){this.deactivate(),this.registerEvents(),this.viewer.enableCursorStyle=!1,this.viewer._element.style.cursor="crosshair",this.isMeasure=!0,this.measureDistance=0}deactivate(){this.isMeasure&&(this.unRegisterEvents(),this.viewer.enableCursorStyle=!0,this.isMeasure=!1,this.tempPositions=[],this.positions=[])}clear(){this.viewer.entities.remove(this.lineEntity),this.lineEntity=void 0,this.vertexEntities.forEach((e=>{this.viewer.entities.remove(e)})),this.vertexEntities=[]}createLineEntity(){this.lineEntity=this.viewer.entities.add({polyline:{positions:new Cesium.CallbackProperty((e=>this.tempPositions),!1),width:2,material:Cesium.Color.YELLOW,depthFailMaterial:Cesium.Color.YELLOW}})}createVertex(){let e=this.viewer.entities.add({position:this.positions[this.positions.length-1],id:"MeasureDistanceVertex"+this.positions[this.positions.length-1],type:"MeasureDistanceVertex",label:{text:this.getSpaceDistance(this.positions)+"米",scale:.5,font:"normal 24px MicroSoft YaHei",distanceDisplayCondition:new Cesium.DistanceDisplayCondition(0,5e3),scaleByDistance:new Cesium.NearFarScalar(1e3,1,3e3,.4),verticalOrigin:Cesium.VerticalOrigin.BOTTOM,style:Cesium.LabelStyle.FILL_AND_OUTLINE,pixelOffset:new Cesium.Cartesian2(0,-30),outlineWidth:9,outlineColor:Cesium.Color.WHITE},point:{color:Cesium.Color.FUCHSIA,pixelSize:8,disableDepthTestDistance:500}});this.vertexEntities.push(e)}createStartEntity(){let e=this.viewer.entities.add({position:this.positions[0],type:"MeasureDistanceVertex",billboard:{image:"static/img/start.png",scaleByDistance:new Cesium.NearFarScalar(300,1,1200,.4),distanceDisplayCondition:new Cesium.DistanceDisplayCondition(0,1e4),verticalOrigin:Cesium.VerticalOrigin.BOTTOM},point:{color:Cesium.Color.FUCHSIA,pixelSize:6}});this.vertexEntities.push(e)}createEndEntity(){let e=this.viewer.entities.getById("MeasureDistanceVertex"+this.positions[this.positions.length-1]);this.viewer.entities.remove(e),this.viewer.entities.remove(this.moveVertexEntity);let t=this.viewer.entities.add({position:this.positions[this.positions.length-1],type:"MeasureDistanceVertex",label:{text:"总距离："+this.getSpaceDistance(this.positions)+"米",scale:.5,font:"normal 26px MicroSoft YaHei",distanceDisplayCondition:new Cesium.DistanceDisplayCondition(0,5e3),scaleByDistance:new Cesium.NearFarScalar(1e3,1,3e3,.4),verticalOrigin:Cesium.VerticalOrigin.BOTTOM,style:Cesium.LabelStyle.FILL_AND_OUTLINE,pixelOffset:new Cesium.Cartesian2(0,-50),outlineWidth:9,outlineColor:Cesium.Color.WHITE,eyeOffset:new Cesium.Cartesian3(0,0,-10)},billboard:{image:"static/img/end.png",scaleByDistance:new Cesium.NearFarScalar(300,1,1200,.4),distanceDisplayCondition:new Cesium.DistanceDisplayCondition(0,1e4),verticalOrigin:Cesium.VerticalOrigin.BOTTOM},point:{color:Cesium.Color.FUCHSIA,pixelSize:6}});this.vertexEntities.push(t)}getSpaceDistance(e){for(var t=0,i=0;i<e.length-1;i++){var n=Cesium.Cartographic.fromCartesian(e[i]),s=Cesium.Cartographic.fromCartesian(e[i+1]),o=new Cesium.EllipsoidGeodesic;o.setEndPoints(n,s);var r=o.surfaceDistance;r=Math.sqrt(Math.pow(r,2)+Math.pow(s.height-n.height,2)),t+=r}return t.toFixed(2)}registerEvents(){this.leftClickEvent(),this.rightClickEvent(),this.mouseMoveEvent()}leftClickEvent(){this.handler.setInputAction((e=>{this.viewer._element.style.cursor="crosshair";let t=this.viewer.scene.pickPosition(e.position);if(!t){const i=this.viewer.scene.globe.ellipsoid;t=this.viewer.scene.camera.pickEllipsoid(e.position,i)}if(t){if(this.positions.push(t),1==this.positions.length)return this.createLineEntity(),void this.createStartEntity();this.createVertex()}}),Cesium.ScreenSpaceEventType.LEFT_CLICK)}mouseMoveEvent(){this.handler.setInputAction((e=>{if(!this.isMeasure)return;this.viewer._element.style.cursor="pointer";let t=this.viewer.scene.pickPosition(e.endPosition);t||(t=this.viewer.scene.camera.pickEllipsoid(e.startPosition,this.viewer.scene.globe.ellipsoid)),t&&this.handleMoveEvent(t)}),Cesium.ScreenSpaceEventType.MOUSE_MOVE)}handleMoveEvent(e){this.positions.length<1||(this.tempPositions=this.positions.concat(e))}rightClickEvent(){this.handler.setInputAction((e=>{!this.isMeasure||this.positions.length<1?(this.deactivate(),this.viewer._element.style.cursor="default",this.clear()):(this.createEndEntity(),this.lineEntity.polyline={positions:this.positions,width:2,material:Cesium.Color.YELLOW,depthFailMaterial:Cesium.Color.YELLOW},this.measureEnd())}),Cesium.ScreenSpaceEventType.RIGHT_CLICK)}measureEnd(){this.deactivate(),this.viewer._element.style.cursor="default",this.MeasureEndEvent.raiseEvent(this.measureDistance)}unRegisterEvents(){this.handler.removeInputAction(Cesium.ScreenSpaceEventType.RIGHT_CLICK),this.handler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK),this.handler.removeInputAction(Cesium.ScreenSpaceEventType.MOUSE_MOVE)}}var y=e;class f{constructor(e,t,i){this.viewer=e,this.type=t,this.fun=i,this.mhTool=null,this.maTool=null,this.mdTool=null,this.viewer.cesiumWidget.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK)}initMeasureTools(){switch(this.type){case"height":this.mhTool=new xt3d.Map3dTools.Measure.Height(this.viewer),this.measureHeight();break;case"distance":this.mdTool=new y.Distance(this.viewer),this.measureDistance();break;case"area":this.maTool=new y.Area(this.viewer),this.measureArea();break;case"clear":this.clear();break}}measureDistance(){this.clear(),this.mdTool.activate(),this.mdTool.MeasureEndEvent.addEventListener((()=>{this.fun()}))}measureArea(){this.clear(),this.maTool.activate(),this.maTool.MeasureEndEvent.addEventListener((()=>{this.fun()}))}measureHeight(){this.clear(),this.mhTool.activate(),this.mhTool.MeasureEndEvent.addEventListener((()=>this.fun()))}clear(){this.mhTool&&this.mhTool.deactivate(),this.mhTool&&this.mhTool.clear(),this.mdTool&&this.mdTool.deactivate(),this.mdTool&&this.mdTool.clear(),this.maTool&&this.maTool.deactivate(),this.maTool&&this.maTool.clear()}}class C{constructor(e,t,i){this.viewer=e,this.mouseClickPosition=void 0,this.fdDataServerBaseUrl=t.fdDataServerBaseUrl,this.BuildingSelectedEvent=new Cesium.Event,this.position=i,this.fid=void 0,this.initEvents()}initEvents(){var e=this;null==e.position?new Cesium.ScreenSpaceEventHandler(e.viewer.scene.canvas).setInputAction((function(t){e.isActivate&&(e.BuildingSelectedEvent.raiseEvent(void 0),(t=e.viewer.scene.pickPosition(t.position))&&(e.mouseClickPosition=t,t=Cesium.Cartographic.fromCartesian(t),t=[Cesium.Math.toDegrees(t.longitude),Cesium.Math.toDegrees(t.latitude)],e.queryByPoint(t)))}),Cesium.ScreenSpaceEventType.LEFT_CLICK):e.queryByPoint(e.position,1)}queryByPoint(e,t){console.log(e);var i=this,n=this.fdDataServerBaseUrl+'&filter=<Filter xmlns="http://www.opengis.net/ogc" xmlns:gml="http://www.opengis.net/gml"><Intersects><PropertyName>the_geom</PropertyName><gml:Point><gml:coordinates>'+e[0]+","+e[1]+"</gml:coordinates></gml:Point></Intersects></Filter>";fetch(n).then((function(e){return e.json()})).then((function(n){i.handleQueryResult(n,t,e)})).catch((function(e){console.log(e)}))}handleQueryResult(e,t,i){const n="http://120.27.230.6:8080/geoserver/py/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=py%3Afysqfw&maxFeatures=5000&outputFormat=application%2Fjson",s=n+'&filter=<Filter xmlns="http://www.opengis.net/ogc" xmlns:gml="http://www.opengis.net/gml"><Intersects><PropertyName>the_geom</PropertyName><gml:Point><gml:coordinates>'+i[0]+","+i[1]+"</gml:coordinates></gml:Point></Intersects></Filter>";let o=this;fetch(s).then((function(e){return e.json()})).then((function(i){let n=[],s="";i.features.forEach((e=>{n.push(e.properties.type)})),s=n.length&&n.indexOf("封控区")>-1?"RED":n.indexOf("管控区")>-1?"ORANGE":n.indexOf("防范区")>-1?"YELLOW":"CYAN";let r=e.features[0];if(r){let i=window.viewer.entities.getById("dth"+r.id);if(i)window.viewer.entities.remove(i);else{o.fid=r.id,e=r.geometry,r=r.properties,o.BuildingSelectedEvent.raiseEvent(r,o.mouseClickPosition);let i=[];const n=[];"MultiPolygon"===e.type?i=e.coordinates[0][0]:"Polygon"==e.type&&(i=e.coordinates[0]);for(let e=0;e<i.length;e++){const t=i[e];n.push(t[0]),n.push(t[1]),n.push(0)}o.addClampFeature(n,t,s)}}}))}addClampFeature(e,t,i){this.clampFeature=this.viewer.entities.add({id:"dth"+this.fid,polygon:{hierarchy:new Cesium.PolygonHierarchy(Cesium.Cartesian3.fromDegreesArrayHeights(e)),classificationType:Cesium.ClassificationType.CESIUM_3D_TILE,material:Cesium.Color[i].withAlpha(.5)}}),1==t&&window.viewer.flyTo(this.clampFeature,{duration:1.5,offset:new Cesium.HeadingPitchRange(0,Cesium.Math.toRadians(-90),10)})}clearQueryResult(){this.clampFeature&&(this.viewer.entities.remove(this.clampFeature),this.clampFeature={})}activate(){this.isActivate=!0}deactivate(){this.isActivate=!1}}class E{constructor(e,t){void 0===t&&(t={});var i,n=t.insertAt;e&&"undefined"!=typeof document&&(i=document.head||document.getElementsByTagName("head")[0],(t=document.createElement("style")).type="text/css","top"===n&&i.firstChild?i.insertBefore(t,i.firstChild):i.appendChild(t),t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e)))}}class x{constructor(e,t){this.viewer=e,this.fcPrimitives=[],this.fcDataServerBaseUrl=t.fcDataServerBaseUrl,this.FloorSelectedEvent=new Cesium.Event,this.initEvents()}initEvents(){var e=this;new Cesium.ScreenSpaceEventHandler(e.viewer.scene.canvas).setInputAction((function(t){if(e.isActivate){e.FloorSelectedEvent.raiseEvent(void 0);var i=e.viewer.scene.pick(t.position);if(i){if(i.primitive&&i.primitive instanceof Cesium.ClassificationPrimitive)return void e.handlePickFloor(i);if(i.id&&"highlightFloorEntity"==i.id.type)return}t=e.viewer.scene.pickPosition(t.position),t&&(t=Cesium.Cartographic.fromCartesian(t),t=[Cesium.Math.toDegrees(t.longitude),Cesium.Math.toDegrees(t.latitude)],e.queryByPoint(t))}}),Cesium.ScreenSpaceEventType.LEFT_CLICK)}queryByPoint(e){var t=this,i=this.fcDataServerBaseUrl+'&filter=<Filter xmlns="http://www.opengis.net/ogc" xmlns:gml="http://www.opengis.net/gml"><Intersects><PropertyName>the_geom</PropertyName><gml:Point><gml:coordinates>'+e[0]+","+e[1]+"</gml:coordinates></gml:Point></Intersects></Filter>";fetch(i).then((function(e){return e.json()})).then((function(e){t.handleQueryResult(e)})).catch((function(e){console.log(e)}))}handleQueryResult(e){var t=this;t.clearPrimitives(),e.features.length<1||(t.queryResultFeatures=e.features,e.features.forEach((function(e){t.addPrimitive(e)})))}addPrimitive(e){var t=e.properties;e=turf.buffer(e,.8,{units:"meters"}),e=this.getDegreesArrayHeights(e),e=new Cesium.PolygonGeometry({polygonHierarchy:new Cesium.PolygonHierarchy(Cesium.Cartesian3.fromDegreesArrayHeights(e)),perPositionHeight:!0,extrudedHeight:t.BaseHeight+t.FloorHeigh}),t=t.BuildCode+t.FloorNumbe,e=this.createExtrudedPolygon(t,e),this.fcPrimitives.push(e)}clearPrimitives(){var e=this;this.fcPrimitives.forEach((function(t){e.viewer.scene.primitives.remove(t)})),this.fcPrimitives=[],this.viewer.entities.remove(this.highlightFloorEntity)}createExtrudedPolygon(e,t){return this.viewer.scene.primitives.add(new Cesium.ClassificationPrimitive({geometryInstances:new Cesium.GeometryInstance({geometry:Cesium.PolygonGeometry.createGeometry(t),attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(Cesium.Color.fromRandom({alpha:.8})),show:new Cesium.ShowGeometryInstanceAttribute(!0)},id:e}),classificationType:Cesium.ClassificationType.CESIUM_3D_TILE}))}getDegreesArrayHeights(e){var t=[],i=void 0;"MultiPolygon"==e.geometry.type?i=e.geometry.coordinates[0][0]:"Polygon"==e.geometry.type&&(i=e.geometry.coordinates[0]);for(var n=0;n<i.length;n++){var s=i[n];t.push(s[0]),t.push(s[1]),t.push(e.properties.BaseHeight)}return t}handlePickFloor(e){this.clickHighlightPrimitive&&(this.clickHighlightPrimitive.show=!0),e.primitive.show=!1,this.clickHighlightPrimitive=e.primitive;var t=this.getFeatureByPrimitiveId(e.id);this.FloorSelectedEvent.raiseEvent(t),t=turf.buffer(t,1,{units:"meters"}),this.viewer.entities.remove(this.highlightFloorEntity),e=this.getDegreesArrayHeights(t),this.highlightFloorEntity=this.viewer.entities.add({type:"highlightFloorEntity",polygon:{hierarchy:new Cesium.PolygonHierarchy(Cesium.Cartesian3.fromDegreesArrayHeights(e)),perPositionHeight:!0,extrudedHeight:t.properties.BaseHeight+t.properties.FloorHeigh,material:Cesium.Color.RED.withAlpha(.7)}})}getFeatureByPrimitiveId(e){for(var t=0;t<this.queryResultFeatures.length;t++){var i=this.queryResultFeatures[t].properties;if(i.BuildCode+i.FloorNumbe==e)return this.queryResultFeatures[t]}}setStyle(){var e='.MultiFieldAdaptWindow-container {position: absolute;left: 0px;bottom: 0px;min-width: 350px;min-height: 200px;color: white;}.MultiFieldAdaptWindow-container::before {position: absolute;content: "";top: 100%;left: calc(50% - 20px);border: 20px solid transparent;border-top: 40px solid rgba(30, 32, 42, 0.5);}.MultiFieldAdaptWindow-header {height: 30px;line-height: 30px;color: white;min-width: 200px;padding: 0px 10px;background: #1a4879;border-top-right-radius: 4px;border-top-left-radius: 4px;position: relative;user-select: none;}.MultiFieldAdaptWindow-close {position: absolute;right: 1px;font-size: 25px;cursor: pointer;width: 29px;text-align: center;}.MultiFieldAdaptWindow-close:hover {background: #dc2929b9;}.MultiFieldAdaptWindow-body {padding: 5px;background: linear-gradient( 0deg, rgba(30, 32, 42, 0.5), rgba(13, 16, 19, 0.7));border: 1px solid rgb(29, 26, 26);border-top: 0px;border-bottom-right-radius: 4px;border-bottom-left-radius: 4px;}.MultiFieldAdaptWindow-info-item {margin: 14px 0px;max-width: 350px;}.MultiFieldAdaptWindow-ifno-label {display: inline-block;min-width: 60px;text-align: justify;text-align-last: justify;background: #fff6f625;}.MultiFieldAdaptWindow-ifno-text {background: #fff6f60e;}';E(e,{})}activate(){this.isActivate=!0}deactivate(){this.isActivate=!1}}class b{constructor(e,t){this.viewer=e,this.fhPrimitives=[],this.fcDataServerBaseUrl=t.fcDataServerBaseUrl,this.fhDataServerBaseUrl=t.fhDataServerBaseUrl,this.HouseSelectedEvent=new Cesium.Event,this.initEvents(),this.setStyle()}initEvents(){var e=this;new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas).setInputAction((function(t){if(e.isActivate){var i=e.viewer.scene.pick(t.position);if(i){if(i.primitive&&i.primitive instanceof Cesium.ClassificationPrimitive)return void e.handlePickHouse(i);if(i.id&&"highlightFloorEntity"==i.id.type)return}i=e.viewer.scene.pickPosition(t.position),i&&(t=Cesium.Cartographic.fromCartesian(i),i=[Cesium.Math.toDegrees(t.longitude),Cesium.Math.toDegrees(t.latitude)],e.queryByPoint(i,t.height))}}),Cesium.ScreenSpaceEventType.LEFT_CLICK)}queryByPoint(e,t){var i=this;this.mouseClickHeight=t,e=this.fcDataServerBaseUrl+'&filter=<Filter xmlns="http://www.opengis.net/ogc" xmlns:gml="http://www.opengis.net/gml"><Intersects><PropertyName>the_geom</PropertyName><gml:Point><gml:coordinates>'+e[0]+","+e[1]+"</gml:coordinates></gml:Point></Intersects></Filter>",fetch(e).then((function(e){return e.json()})).then((function(e){i.handleFcQueryResult(e)})).catch((function(e){console.log(e)}))}handleFcQueryResult(e){if(this.clearPrimitives(),this.HouseSelectedEvent.raiseEvent(void 0),!(e.features.length<1)){for(var t,i,n=void 0,s=0;s<e.features.length;s++){var o=e.features[s];if(this.mouseClickHeight>=o.properties.BaseHeight&&this.mouseClickHeight<=o.properties.TopHeight){n=o;break}}console.log(n),n&&(t=n.properties.BuildCode,i=n.properties.FloorNumbe,this.queryBySQL(t,i))}}queryBySQL(e,t){var i=this;t=this.fhDataServerBaseUrl+"&cql_filter=BuildCode="+e+" and FloorNumbe="+t;fetch(t).then((function(e){return e.json()})).then((function(e){console.log(e),i.handleFhQueryResult(e)})).catch((function(e){console.log(e)}))}handleFhQueryResult(e){var t=this;e.features.length<1||(this.queryResultFeatures=e.features,e.features.forEach((function(e){console.log(e),t.addPrimitive(e)})))}addPrimitive(e){console.log(e);var t=e.properties;e=turf.buffer(e,.8,{units:"meters"}),e=this.getDegreesArrayHeights(e),e=new Cesium.PolygonGeometry({polygonHierarchy:new Cesium.PolygonHierarchy(Cesium.Cartesian3.fromDegreesArrayHeights(e)),perPositionHeight:!0,extrudedHeight:t.BaseHeight+t.FloorHeigh}),t=t.BuildCode+t.FloorNumbe+t.HouseCode,e=this.createExtrudedPolygon(t,e),this.fhPrimitives.push(e)}clearPrimitives(){var e=this;this.fhPrimitives.forEach((function(t){e.viewer.scene.primitives.remove(t)})),this.fhPrimitives=[],this.viewer.entities.remove(this.highlightFloorEntity)}createExtrudedPolygon(e,t){return this.viewer.scene.primitives.add(new Cesium.ClassificationPrimitive({geometryInstances:new Cesium.GeometryInstance({geometry:Cesium.PolygonGeometry.createGeometry(t),attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(Cesium.Color.fromRandom({alpha:.8})),show:new Cesium.ShowGeometryInstanceAttribute(!0)},id:e}),classificationType:Cesium.ClassificationType.CESIUM_3D_TILE}))}getDegreesArrayHeights(e){var t=[],i=void 0;"MultiPolygon"==e.geometry.type?i=e.geometry.coordinates[0][0]:"Polygon"==e.geometry.type&&(i=e.geometry.coordinates[0]);for(var n=0;n<i.length;n++){var s=i[n];t.push(s[0]),t.push(s[1]),t.push(e.properties.BaseHeight)}return t}handlePickHouse(e){this.clickHighlightPrimitive&&(this.clickHighlightPrimitive.show=!0),e.primitive.show=!1,this.clickHighlightPrimitive=e.primitive;var t=this.getFeatureByPrimitiveId(e.id);this.HouseSelectedEvent.raiseEvent(t),t=turf.buffer(t,1,{units:"meters"}),this.viewer.entities.remove(this.highlightFloorEntity),e=this.getDegreesArrayHeights(t),this.highlightFloorEntity=this.viewer.entities.add({type:"highlightFloorEntity",polygon:{hierarchy:new Cesium.PolygonHierarchy(Cesium.Cartesian3.fromDegreesArrayHeights(e)),perPositionHeight:!0,extrudedHeight:t.properties.BaseHeight+t.properties.FloorHeigh,material:Cesium.Color.RED.withAlpha(.7)}})}getFeatureByPrimitiveId(e){for(var t=0;t<this.queryResultFeatures.length;t++){var i=this.queryResultFeatures[t].properties;if(i.BuildCode+i.FloorNumbe+i.HouseCode==e)return this.queryResultFeatures[t]}}setStyle(){var e='.MultiFieldAdaptWindow-container {position: absolute;left: 0px;bottom: 0px;min-width: 350px;min-height: 200px;color: white;}.MultiFieldAdaptWindow-container::before {position: absolute;content: "";top: 100%;left: calc(50% - 20px);border: 20px solid transparent;border-top: 40px solid rgba(30, 32, 42, 0.5);}.MultiFieldAdaptWindow-header {height: 30px;line-height: 30px;color: white;min-width: 200px;padding: 0px 10px;background: #1a4879;border-top-right-radius: 4px;border-top-left-radius: 4px;position: relative;user-select: none;}.MultiFieldAdaptWindow-close {position: absolute;right: 1px;font-size: 25px;cursor: pointer;width: 29px;text-align: center;}.MultiFieldAdaptWindow-close:hover {background: #dc2929b9;}.MultiFieldAdaptWindow-body {padding: 5px;background: linear-gradient( 0deg, rgba(30, 32, 42, 0.5), rgba(13, 16, 19, 0.7));border: 1px solid rgb(29, 26, 26);border-top: 0px;border-bottom-right-radius: 4px;border-bottom-left-radius: 4px;}.MultiFieldAdaptWindow-info-item {margin: 14px 0px;max-width: 350px;}.MultiFieldAdaptWindow-ifno-label {display: inline-block;min-width: 60px;text-align: justify;text-align-last: justify;background: #fff6f625;}.MultiFieldAdaptWindow-ifno-text {background: #fff6f60e;}';new E(e,{})}activate(){this.isActivate=!0}deactivate(){this.isActivate=!1}}var P=function(){var e=this,t=e._self._c;return t("div",[e._v(" "+e._s(e.properties.FloorNumbe)+"层"+e._s(e.properties.Householde)+" ")])},S=[],M={name:"FcDialog",props:["properties"],data(){return{}},components:{},methods:{},computed:{},watch:{},mounted(){}},T=M;function D(e,t,i,n,s,o,r,a){var l,h="function"===typeof e?e.options:e;if(t&&(h.render=t,h.staticRenderFns=i,h._compiled=!0),n&&(h.functional=!0),o&&(h._scopeId="data-v-"+o),r?(l=function(e){e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,e||"undefined"===typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),s&&s.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(r)},h._ssrRegister=l):s&&(l=a?function(){s.call(this,(h.functional?this.parent:this).$root.$options.shadowRoot)}:s),l)if(h.functional){h._injectStyles=l;var c=h.render;h.render=function(e,t){return l.call(t),c(e,t)}}else{var d=h.beforeCreate;h.beforeCreate=d?[].concat(d,l):[l]}return{exports:e,options:h}}var _=D(T,P,S,!1,null,"39fde2cb",null),k=_.exports,L={name:"cesium-rightclick-menu",components:{FcDialog:k},props:{toCenter:{type:Function,default:function(){return()=>{}}},load3dTiles:{type:Function,default:function(){return()=>{}}},loadRegion:{type:Function,default:function(){return()=>{}}},enableRightClickDeletion:{type:Boolean,default:function(){return!1}},showDkInfo:{type:Boolean,default:()=>!1}},data(){return{alertMenuState:!1,alertMenuStyle:{left:0,top:0},menuList:[{label:"查看坐标",icon:"icon-chakanzuobiao",handler:"showClickedPosition"},{label:"场景服务",icon:"icon-changjingjuanlian",children:[{label:"历史场景",icon:"icon-lishijilu",handler:"addSplitLayer",isSwitch:!0,active:!1},{label:"场景出图",icon:"icon-xiangji1fill",handler:"sceneToFile"}]},{label:"视角切换",icon:"icon-yanjing_xianshi",children:[{label:"地下开挖",icon:"icon-xiayi",handler:"initExcavate",isSwitch:!0,active:!1},{label:"环绕飞行",icon:"icon-icon-feixingmanyou",handler:"initFlyAround",isSwitch:!0,active:!1},{label:"第一视角",icon:"icon-xingren",handler:"initPeopleView",isSwitch:!0,active:!1},{label:"键盘漫游",icon:"icon-jianpan",handler:"initKeyboardTour",isSwitch:!0,active:!1}]},{label:"地形分析",icon:"icon-quanjing",children:[{label:"地形",icon:"icon-yuanjing",handler:"initTerrain",isSwitch:!0,active:!1},{label:"限高分析",icon:"icon-jianzhu",handler:"initLimitHeight",isSwitch:!0,active:!1},{label:"淹没分析",icon:"icon-yanmeiguocheng",handler:"initFloodAnalysis",isSwitch:!0,active:!1}]},{label:"图上量算",icon:"icon-celiang",children:[{label:"距离",icon:"icon-juliceliang",handler:"measureDistance"},{label:"面积",icon:"icon-mianji",handler:"measureArea"},{label:"高度",icon:"icon-colum-height",handler:"measureHeight"},{label:"清除",icon:"icon-shanchu",handler:"measureClear"}]},{label:"图上标记",icon:"icon-Markerbiaoji",children:[{label:"标记点",icon:"icon-weizhi",handler:"addMarkerPoint"},{label:"标记线",icon:"icon-xianduan",handler:"addMarkerLine"},{label:"标记面",icon:"icon-polygon-fill",handler:"addMarkerPolygon"},{label:"标记圆",icon:"icon-ditu-yuan",handler:"addMarkerCircular"},{label:"标记矩形",icon:"icon-rect",handler:"addMarkerRectangle"},{label:"清除",icon:"icon-shanchu",handler:"clearMarkers"}]},{label:"场景效果",icon:"icon-zaixinqiumianchangjingchuangkoudakai",children:[{label:"下雨",icon:"icon-shui",handler:"startRain",isSwitch:!0,active:!1},{label:"下雪",icon:"icon-xue",handler:"startSnow",isSwitch:!0,active:!1},{label:"雾",icon:"icon-wu",handler:"startFog",isSwitch:!0,active:!1},{label:"夜视",icon:"icon-yeshi",handler:"startNightVision",isSwitch:!0,active:!1},{label:"黑白",icon:"icon-heibai",handler:"startB_W",isSwitch:!0,active:!1}]}],activeMenuList:[],menu_level2Style:{},activeIndex:null,activeSubIndex:0,rightClickedPosition:null,sliderShow:!1,splitHandler:null,earthAtRightLayer:null,terrainExcavate:null,excavateDepth:null,isEditing:!1,limitHeight:null,limitHeightShow:!1,height:30,maTool:null,mhTool:null,mdTool:null,markersArr:[],properties:null,highlightFace:null,delDialogShow:!1,activeEntity:null,dkInfoDialogShow:!1,propertiesObj:{},videoPlane:null,positionEntity:null}},methods:{initMap(){const e={navigation:!1,sceneModePicker:!1,geocoder:!1,homeButton:!1,timeline:!1,navigationHelpButton:!1,fullscreenButton:!1,scene3DOnly:!0,baseLayerPicker:!1,animation:!1,infoBox:!1,shouldAnimate:!0,selectionIndicator:!1,contextOptions:{webgl:{alpha:!0,depth:!0,stencil:!0,antialias:!0,premultipliedAlpha:!0,preserveDrawingBuffer:!0,failIfMajorPerformanceCaveat:!0}}};Cesium.Ion.defaultAccessToken="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJhMWRhNjczZi1jODI2LTQzMTctYWM3Mi0yOTcwNjE4MmJhY2YiLCJpZCI6NzE0MzgsImlhdCI6MTYzOTk4MjEyMH0.RbSKlFOzNyLXNnFfq631lXEGMJzMYL0RzGhOUvnlZBY";let t=new Cesium.Viewer("map3d",e);t._cesiumWidget._creditContainer.style.display="none",t.scene.globe.depthTestAgainstTerrain=!0;const i=new Cesium.UrlTemplateImageryProvider({url:Cesium.buildModuleUrl("http://120.27.230.6/tdt_yx")+"/{z}/{x}/{reverseY}.jpg",tilingScheme:new Cesium.GeographicTilingScheme,maximumLevel:19});let n=t.imageryLayers.addImageryProvider(i);n.ImagerySplitDirection=Cesium.ImagerySplitDirection.LEFT,window.viewer=t,this.toCenter&&this.toCenter(),this.loadRegion&&this.loadRegion(),this.load3dTiles&&this.load3dTiles()},initRightClick(){let e=new Cesium.ScreenSpaceEventHandler(window.viewer.scene.canvas),t=this;e.setInputAction((function(e){t.activeIndex=null,t.rightClickedPosition=h(e.position,window.viewer);const i=window.viewer.scene.pick(e.position);i&&i.id?t.enableRightClickDeletion&&(t.activeEntity=i.id,t.highlightFace&&(t.highlightFace.material=t.highlightFace.material0),i.id.polygon.material0=i.id.polygon.material,i.id.polygon.material=Cesium.Color.AQUA.withAlpha(.5),t.highlightFace=i.id.polygon,t.delDialogShow=!0):t.isEditing||(t.alertMenuStyle=l(e.position.x,e.position.y,t.$refs.alertMenu.clientWidth,t.$refs.alertMenu.clientHeight),t.showOrHiddenRightClickMenu(!0))}),Cesium.ScreenSpaceEventType.RIGHT_CLICK)},initLeftClick(){let e=new Cesium.ScreenSpaceEventHandler(window.viewer.scene.canvas);e.setInputAction((e=>{const t=window.viewer.scene.pick(e.position);this.showOrHiddenRightClickMenu(!1),this.highlightFace&&(this.highlightFace.material=this.highlightFace.material0),t&&t.id&&t.id.canShow&&(this.activeEntity=t.id,t.id.polygon.material0=t.id.polygon.material,t.id.polygon.material=Cesium.Color.AQUA,this.highlightFace=t.id.polygon,this.showDkInfo&&this.showDkInfos())}),Cesium.ScreenSpaceEventType.LEFT_CLICK)},showDkInfos(){this.dkInfoDialogShow=!0;let e=this.activeEntity;this.propertiesObj=e.propertiesObj},changeActiveEntityColor(e){let t=getColor(e[0]);this.activeEntity.polygon.material=Cesium.Color.fromCssColorString(t),this.activeEntity.label=u(e[1])},handleDkInfoClose(){this.dkInfoDialogShow=!1,this.highlightFace&&(this.highlightFace.material=this.highlightFace.material0)},onCancel(){this.delDialogShow=!1},onDelete(){window.viewer.entities.remove(this.activeEntity),this.delDialogShow=!1},showOrHiddenRightClickMenu(e){this.alertMenuState=e},handleHover(e){this.activeIndex=e,this.activeSubIndex=0;let t=this.$refs[`menuItem${e}`];this.menu_level2Style={marginTop:t[0].offsetTop+"px"},this.activeMenuList=this.menuList[e].children},handleSubHover(e){this.activeSubIndex=e},executionMethod(e,t){void 0!==t&&t.toString()&&(this.activeMenuList[t].active=!this.activeMenuList[t].active),e&&this[e](),this.showOrHiddenRightClickMenu(!1)},showClickedPosition(){window.viewer.entities.remove(this.positionEntity),this.positionEntity=new Cesium.Entity({position:Cesium.Cartesian3.fromDegrees(this.rightClickedPosition.lng,this.rightClickedPosition.lat),point:{color:Cesium.Color.RED,pixelSize:8}}),window.viewer.entities.add(this.positionEntity);let e=this.rightClickedPosition.lng+","+this.rightClickedPosition.lat;p(this.positionEntity,"Point",e)},sceneToFile(){d(window.viewer)},addSplitLayer(){let e=new Cesium.UrlTemplateImageryProvider({url:"http://webrd02.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&x={x}&y={y}&z={z}",minimumLevel:1,maximumLevel:18});this.sliderShow?(this.splitHandler.destroy(),this.splitHandler=null,window.viewer.imageryLayers.remove(this.earthAtRightLayer),this.sliderShow=!1):(this.sliderShow=!0,this.$nextTick((()=>{const t=window.viewer.imageryLayers,i=t.addImageryProvider(e);this.earthAtRightLayer=i,i.splitDirection=Cesium.ImagerySplitDirection.RIGHT;const n=document.getElementById("slider");if(n){window.viewer.scene.imagerySplitPosition=n.offsetLeft/n.parentElement.offsetWidth;const s=new Cesium.ScreenSpaceEventHandler(n);this.splitHandler=s;let o=!1;function r(e){if(!o)return;const t=e.endPosition.x,i=(n.offsetLeft+t)/n.parentElement.offsetWidth;n.style.left=100*i+"%",window.viewer.scene.imagerySplitPosition=i}s.setInputAction((function(){o=!0}),Cesium.ScreenSpaceEventType.LEFT_DOWN),s.setInputAction((function(){o=!0}),Cesium.ScreenSpaceEventType.PINCH_START),s.setInputAction(r,Cesium.ScreenSpaceEventType.MOUSE_MOVE),s.setInputAction(r,Cesium.ScreenSpaceEventType.PINCH_MOVE),s.setInputAction((function(){o=!1}),Cesium.ScreenSpaceEventType.LEFT_UP),s.setInputAction((function(){o=!1}),Cesium.ScreenSpaceEventType.PINCH_END)}})))},initExcavate(){if(this.terrainExcavate){this.terrainExcavate.clear(),this.terrainExcavate=null;let e=window.viewer.entities.getById("Polygon_Label");window.viewer.entities.remove(e)}else this.isEditing=!0,this.terrainExcavate=new xt3d.ExcavateAnalysis.TerrainExcavate(window.viewer),this.initEntityDraw(),this.drawActivate("Polygon"),this.entityDraw.DrawEndEvent.addEventListener(((e,t)=>{e.remove(),p(e,"Polygon","开挖测试"),this.$prompt("请输入大于0的数字","开挖深度",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^(([0-9]+\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\.[0-9]+)|([0-9]*[1-9][0-9]*))$/,inputErrorMessage:"数字格式不正确"}).then((({value:e})=>{this.terrainExcavate.add(t,{excavateDepth:e,bottomImage:n(838),sideImage:n(186)}),this.isEditing=!1})).catch((()=>{this.terrainExcavate&&(this.terrainExcavate.clear(),this.terrainExcavate=null);let e=window.viewer.entities.getById("Polygon_Label");window.viewer.entities.remove(e),this.activeMenuList[0].active=!1,this.isEditing=!1}))})),this.entityDraw.CancelEvent.addEventListener((()=>{this.terrainExcavate&&(this.terrainExcavate.clear(),this.terrainExcavate=null);let e=window.viewer.entities.getById("Polygon_Label");window.viewer.entities.remove(e),this.activeMenuList[0].active=!1,this.isEditing=!1}))},initFlyAround(){if(this.windingPoint)this.windingPoint.deactivate(),window.viewer.entities.removeById("flyPoint"),this.windingPoint=null;else{let e=this.$notify({title:"提示",message:"点击左键进行选点，围绕该点进行环绕飞行",duration:0});this.initEntityDraw(),this.drawActivate("Point"),this.entityDraw.DrawEndEvent.addEventListener(((t,i)=>{e.close(),t.remove(),window.viewer.entities.add({id:"flyPoint",position:i[0],point:{pixelSize:4,color:Cesium.Color.RED,disableDepthTestDistance:Number.POSITIVE_INFINITY}}),this.windingPoint=new xt3d.CameraDominate.WindingPoint(window.viewer,i[0]),this.windingPoint.activate()}))}},initPeopleView(){if(this.roamObj)this.roamObj.stop(),this.roamObj=null,window.viewer.entities.removeById("romaLine");else{let e=this.$notify({title:"提示",message:"请先绘制运动路径",duration:0});this.isEditing=!0,this.initEntityDraw(),this.drawActivate("Polyline"),this.entityDraw.DrawEndEvent.addEventListener(((t,i)=>{this.isEditing=!1,e.close(),t.remove(),window.viewer.entities.add({id:"romaLine",polyline:{positions:new Cesium.CallbackProperty((e=>i),!1),width:3,material:new Cesium.PolylineOutlineMaterialProperty({color:Cesium.Color.YELLOW}),depthFailMaterial:new Cesium.PolylineOutlineMaterialProperty({color:Cesium.Color.YELLOW})}}),this.roamObj=new xt3d.TrackRoam.Roam(window.viewer,i,{speed:10,modelUrl:"static/img/CesiumMilkTruck.glb",scale:1,role:2}),this.roamObj.start()}))}},initKeyboardTour(){if(this.keyboardModel)this.keyboardModel.deactivate(),this.keyboardModel=null;else{let e=this.$notify({title:"提示",dangerouslyUseHTMLString:!0,message:'点击左键选择起点，使用<span style="color: darkcyan">W</span>（前进）<span style="color: darkcyan">A</span>（左转）<span style="color: darkcyan">S</span>（后退）<span style="color: darkcyan">D</span>（右转）进行控制',duration:0});this.initEntityDraw(),this.drawActivate("Point"),this.entityDraw.DrawEndEvent.addEventListener(((t,i)=>{e.close(),t.remove(),this.keyboardModel=new xt3d.KeyboardDominate.KeyboardModelExt(window.viewer,i[0],{modelUrl:"static/img/CesiumMilkTruck.glb",scale:1,minimumPixelSize:20,angle:1,speed:1,role:1,aotuPickHeight:!1}),this.keyboardModel.activate()}))}},initTerrain(){window.viewer.terrainProvider._scheme?viewer.terrainProvider=new Cesium.EllipsoidTerrainProvider({}):window.viewer.terrainProvider=new Cesium.CesiumTerrainProvider({url:"http://120.27.230.6/yhterrain"})},valueChange(){this.limitHeight&&this.limitHeight.setHeight(this.height)},initLimitHeight(){this.limitHeight?(this.limitHeight.remove(),this.limitHeight=null,this.limitHeightShow=!1):(this.isEditing=!0,this.initEntityDraw(),this.drawActivate("Polygon"),this.entityDraw.DrawEndEvent.addEventListener(((e,t)=>{e.remove();let i=[];t.forEach((e=>{let t=c(e,window.viewer);i.push(t.lng),i.push(t.lat)})),this.limitHeightShow=!0,this.limitHeight=new xt3d.SpatialAnalysis.LimitHeight(window.viewer,i,30),this.isEditing=!1})),this.entityDraw.CancelEvent.addEventListener((()=>{this.limitHeight.remove(),this.limitHeight=null,this.limitHeightShow=!1,this.isEditing=!1})))},initFloodAnalysis(){const{viewer:e}=window;e.entities.getById("floodEntity")?e.entities.remove(e.entities.getById("floodEntity")):(this.isEditing=!0,this.initEntityDraw(),this.drawActivate("Polygon"),this.entityDraw.DrawEndEvent.addEventListener(((t,i)=>{t.remove(),this.$prompt("请输入大于0的数字","淹没深度",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^(([0-9]+\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\.[0-9]+)|([0-9]*[1-9][0-9]*))$/,inputErrorMessage:"数字格式不正确"}).then((({value:e})=>{this.flood(i,e),this.isEditing=!1})).catch((()=>{e.entities.remove(e.entities.getById("floodEntity")),this.activeMenuList[2].active=!1,this.isEditing=!1}))})),this.entityDraw.CancelEvent.addEventListener((()=>{e.entities.remove(e.entities.getById("floodEntity")),this.isEditing=!1})))},flood(e,t){var i=1,n=t,s=2,o=(n-i)/s;let r=window.viewer.entities.add({id:"floodEntity",polygon:{hierarchy:e,closeTop:!0,closeBottom:!0,fill:!0,classificationType:Cesium.ClassificationType.BOTH,material:Cesium.Color.fromAlpha(Cesium.Color.fromCssColorString("#007FFF"),.4),perPositionHeight:!0,extrudedHeight:0}});var a=setInterval((()=>{i<n&&(i+=o/30,r.polygon.extrudedHeight=new Cesium.CallbackProperty((function(e,t){return i}),!1),i>n&&(i=n,clearInterval(a)))}),1e3/30)},createPolygon(e){let t=new Cesium.Primitive({allowPicking:!1,asynchronous:!1,geometryInstances:new Cesium.GeometryInstance({id:"floodGeoInstance",geometry:new Cesium.PolygonGeometry({polygonHierarchy:new Cesium.PolygonHierarchy(e),vertexFormat:Cesium.EllipsoidSurfaceAppearance.VERTEX_FORMAT,extrudedHeight:1,height:0})}),appearance:new Cesium.EllipsoidSurfaceAppearance({aboveGround:!0,material:new Cesium.Material({fabric:{type:"Water",uniforms:{normalMap:Cesium.buildModuleUrl("static/img/flood.png"),frequency:1e4,animationSpeed:.01,amplitude:1}}})})});this.tileset1=window.viewer.scene.primitives.add(t)},initMeasure(){let e=()=>{this.isEditing=!1};this.mdTool=new f(window.viewer,"distance",e),this.maTool=new f(window.viewer,"area",e),this.mhTool=new f(window.viewer,"height",e)},measureDistance(){this.isEditing=!0,this.mdTool.initMeasureTools()},measureArea(){this.isEditing=!0,this.maTool.initMeasureTools()},measureHeight(){this.isEditing=!0,this.mhTool.initMeasureTools()},measureClear(){this.mdTool.clear(),this.maTool.clear(),this.mhTool.clear()},spontaneousCall(e){this[e.fun]()},initMarkerTool(){this.militaryPlotLayer=new xt3d.LabelPlotting.MilitaryPlot.PlotLayer(window.viewer),this.militaryPlotLayer.setPlotSelectable(!0),this.plotDraw=new xt3d.LabelPlotting.MilitaryPlot.PlotDraw(window.viewer),this.plotDraw.PlotDrawEndEvent.addEventListener(((e,t)=>{e.remove(),this.isEditing=!1,this.militaryPlotLayer.addPlot(e.toGeoJson())}))},addMarkerPoint(){this.isEditing=!0,this.initEntityDraw(),this.drawActivate("Point"),this.entityDraw.DrawEndEvent.addEventListener(((e,t)=>{this.$prompt("请输入标记名称","标记点",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((({value:t})=>{p(e,"Point",t),this.markersArr.push(e),this.isEditing=!1})).catch((()=>{window.viewer.entities.remove(e),this.isEditing=!1}))})),this.entityDraw.CancelEvent.addEventListener((()=>{this.isEditing=!1}))},addMarkerLine(){this.isEditing=!0,this.initEntityDraw(),this.drawActivate("Polyline"),this.entityDraw.DrawEndEvent.addEventListener(((e,t)=>{this.$prompt("请输入标记名称","标记线段",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((({value:t})=>{p(e,"Polyline",t),this.markersArr.push(e),this.isEditing=!1})).catch((()=>{window.viewer.entities.remove(e),this.isEditing=!1}))})),this.entityDraw.CancelEvent.addEventListener((()=>{this.isEditing=!1}))},addMarkerPolygon(){this.isEditing=!0,this.initEntityDraw(),this.drawActivate("Polygon"),this.entityDraw.DrawEndEvent.addEventListener(((e,t)=>{this.$prompt("请输入标记名称","标记面",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((({value:t})=>{p(e,"Polygon",t),this.markersArr.push(e),this.isEditing=!1})).catch((()=>{window.viewer.entities.remove(e),this.isEditing=!1}))})),this.entityDraw.CancelEvent.addEventListener((()=>{this.isEditing=!1}))},addMarkerCircular(){this.isEditing=!0,this.initEntityDraw(),this.drawActivate("Circle"),this.entityDraw.DrawEndEvent.addEventListener(((e,t)=>{this.$prompt("请输入标记名称","标记圆",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((({value:t})=>{p(e,"Circle",t),this.markersArr.push(e),this.isEditing=!1})).catch((()=>{window.viewer.entities.remove(e),this.isEditing=!1}))})),this.entityDraw.CancelEvent.addEventListener((()=>{this.isEditing=!1}))},addMarkerRectangle(){this.isEditing=!0,this.initEntityDraw(),this.drawActivate("Rectangle"),this.entityDraw.DrawEndEvent.addEventListener(((e,t)=>{this.$prompt("请输入标记名称","标记矩形",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((({value:t})=>{p(e,"Rectangle",t),this.markersArr.push(e),this.isEditing=!1})).catch((()=>{window.viewer.entities.remove(e),this.isEditing=!1}))})),this.entityDraw.CancelEvent.addEventListener((()=>{this.isEditing=!1}))},clearMarkers(){this.markersArr.forEach((e=>{window.viewer.entities.remove(e);let t=window.viewer.entities.getById("Polygon_Label");window.viewer.entities.remove(t)})),this.militaryPlotLayer.clear()},startRain(){this.weatherEffect1?(this.weatherEffect1.removeEffect(),this.weatherEffect1=null):(this.weatherEffect1=new xt3d.SceneDominate.WeatherEffect(window.viewer),this.weatherEffect1.addRainEffect())},startSnow(){this.weatherEffect2?(this.weatherEffect2.removeEffect(),this.weatherEffect2=null):(this.weatherEffect2=new xt3d.SceneDominate.WeatherEffect(window.viewer),this.weatherEffect2.addSnowEffect())},startFog(){this.weatherEffect3?(this.weatherEffect3.removeEffect(),this.weatherEffect3=null):(this.weatherEffect3=new xt3d.SceneDominate.WeatherEffect(window.viewer),this.weatherEffect3.addFogEffect())},startNightVision(){this.nightVisionEffect?(this.nightVisionEffect.enabled=!1,this.nightVisionEffect=null):(this.nightVisionEffect=new xt3d.SceneDominate.NightVisionEffect(window.viewer),this.nightVisionEffect.enabled=!0)},startB_W(){this.BlackAndWhiteEffect?(this.BlackAndWhiteEffect.remove(),this.BlackAndWhiteEffect=null):(this.BlackAndWhiteEffect=new xt3d.SceneDominate.BlackAndWhiteEffect(window.viewer),this.BlackAndWhiteEffect.enabled=!0)},initEntityDraw(){this.entityDraw=new m(window.viewer)},drawActivate(e){this.entityDraw.activate(e)},initDthFd(){this.fdDTH=new C(window.viewer,{fdDataServerBaseUrl:"http://120.27.230.6:8080/geoserver/py/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=py%3Axssq&maxFeatures=5000&outputFormat=application%2Fjson"}),this.fdDTH.BuildingSelectedEvent.addEventListener(((e,t,i,n,s=!1)=>{})),this.fdDTH.activate()},initDthFc(){let e=new x(window.viewer,{fcDataServerBaseUrl:"http://42.192.134.169:8090/geoserver/xt3d/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=xt3d%3Afc_offset&maxFeatures=5000&outputFormat=application%2Fjson"});e.FloorSelectedEvent.addEventListener((e=>{this.properties=e?e.properties:null})),e.activate()},initDthFh(){let e=new b(window.viewer,{fcDataServerBaseUrl:"http://42.192.134.169:8090/geoserver/xt3d/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=xt3d%3Afc_offset&maxFeatures=50&outputFormat=application%2Fjson",fhDataServerBaseUrl:"http://42.192.134.169:8090/geoserver/xt3d/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=xt3d%3Afh_offset&maxFeatures=50&outputFormat=application%2Fjson"});e.HouseSelectedEvent.addEventListener((e=>{this.properties=e?e.properties:null})),e.activate()},addVideo(){let e=Cesium.Cartesian3.fromDegrees(120.3008555978398,30.406375251999187,10),t=window.viewer.entities.add({position:e,point:{pixelSize:10,color:Cesium.Color.YELLOW}});window.viewer.zoomTo(t);const i=document.getElementById("myVideo");new Cesium.VideoSynchronizer({clock:viewer.clock,element:i});window.viewer.clock.shouldAnimate=!0,i.style.display="none",this.videoPlane=new xt3d.VideoPlugin.VideoPlane(window.viewer,e,{videoElement:i,rotation:{heading:90,pitch:80,roll:0},near:0,far:30,fov:29,aspectRatio:1,stRotation:301,debugFrustum:!0})},closeVideo(){this.videoPlane.remove()}},mounted(){this.$nextTick((()=>{document.oncontextmenu=new Function("event.returnValue=false"),document.onselectstart=new Function("event.returnValue=false"),this.$on("spontaneousCall",(e=>{this.spontaneousCall(e)}))})),this.initMap(),this.initRightClick(),this.initLeftClick(),this.initMeasure(),this.initMarkerTool()},beforeDestroy(){window.viewer.entities.removeAll(),window.viewer.imageryLayers.removeAll(!0),window.viewer.destroy()}},I=L,F=(n(28),D(I,o,r,!1,null,"4e672d48",null)),A=F.exports;A.install=e=>{e.component(A.name,A)};var H=A;const O=[H],B=e=>{B.installed||O.map((t=>e.component(t.name,t)))};"undefined"!==typeof window&&window.Vue&&B(window.Vue);var R={install:B,cMap:H},W=R}(),s}()}));
//# sourceMappingURL=landscape-components.umd.min.js.map